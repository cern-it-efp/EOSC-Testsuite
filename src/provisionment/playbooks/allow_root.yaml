- name: Allow root ssh
  when: open_user != "root"
  become: yes
  block:

  - name: Create /root/.ssh dir
    ignore_errors: yes
    file:
      path: /root/.ssh
      state: directory

  - name: Copy {{ open_user }}'s authorized_keys file to root's .ssh directory
    #when: {{ open_user }} != root
    #when: open_user != "root"
    copy:
      src: /home/{{ open_user }}/.ssh/authorized_keys # TODO: if the provided openUser/remote_user is root (exoscale, bc provisionment.py defaults it to root in case of missing openUser at configs.yml) this path fails! either avoid or workaround
      dest: /root/.ssh
      remote_src: yes

  - name: Set PermitRootLogin to yes
    lineinfile:
      path: /etc/ssh/sshd_config
      line: 'PermitRootLogin yes'
      insertbefore: BOF

  - name: Restart sshd
    ignore_errors: yes
    service:
      name: sshd
      enabled: yes
      state: restarted
