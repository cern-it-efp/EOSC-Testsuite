provider "opentelekomcloud" {
  access_key = yamldecode(file(var.authFile))["accK"]
  secret_key = yamldecode(file(var.authFile))["secK"]
  domain_name = var.domainName
  tenant_name = var.tenantName
  auth_url    = "https://iam.eu-de.otc.t-systems.com/v3"
}

resource "opentelekomcloud_compute_instance_v2" "kubenode" {
  name = "${var.instanceName}-${count.index}"
  flavor_name = var.flavor
  key_pair = var.keyPair
  security_groups = var.securityGroups

  block_device {
    uuid                  = var.imageID
    source_type           = "image"
    volume_size           = var.diskSize
    boot_index            = 0
    destination_type      = "volume"
    delete_on_termination = true
    volume_type           = "SATA"
  }
}
