apiVersion: v1
kind: Pod
metadata:
  name: ps-pod
  namespace: default
  labels:
    test: test-pod
spec:
  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
          - key: test
            operator: In
            values:
            - test-pod
        topologyKey: kubernetes.io/hostname
  hostNetwork: true
  containers:
  - name: ps-cont
    image: perfsonar/testpoint:v4.3.4
    imagePullPolicy: Always
    securityContext:
      privileged: true
    command: ["/bin/sh","-c"]
    args:
    - wget https://raw.githubusercontent.com/cern-it-efp/EOSC-Testsuite/development/src/tests/perfsonar/ps_test.py &&
      yum -y install python-dateutil python-requests &&
      python -u ps_test.py --ep $ENDPOINT &&
      sleep infinity
