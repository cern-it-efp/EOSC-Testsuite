

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1. Getting started &mdash; Cloud Test Suite - CERN IT  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="2. Using existing clusters" href="existingClusters.html" />
    <link rel="prev" title="OCRE Test-Suite for cloud validation - CERN" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Cloud Test Suite Documentation</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#install-terraform">1.1 Install Terraform</a></li>
<li class="toctree-l2"><a class="reference internal" href="#manage-ssh-keys">1.2 Manage ssh keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">1.3 Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#kubernetes-client">Kubernetes client</a></li>
<li class="toctree-l3"><a class="reference internal" href="#python">Python</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#download-and-preparation">1.4 Download and preparation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#clone-repository">Clone repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tests-catalog">Tests Catalog</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#run-the-test-suite">1.5 Run the test-suite</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#options">Options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="existingClusters.html">2. Using existing clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="results.html">3. Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="verification.html">4. Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="costs.html">5. Cost of run calculation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Cloud Test Suite - CERN IT</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>1. Getting started</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/gettingStarted.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="getting-started">
<h1>1. Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<p>Follow these steps to test a cloud provider:</p>
<div class="section" id="install-terraform">
<h2>1.1 Install Terraform<a class="headerlink" href="#install-terraform" title="Permalink to this headline">¶</a></h2>
<p>Terraform is the tool that creates the VMs that will later become a Kubernetes cluster. The test-suite makes use of it so download and
install <a class="reference external" href="https://learn.hashicorp.com/terraform/getting-started/install.html">Terraform</a> on your machine.
In some cases, providers are not fully supported by Terraform but these provide plugins to gap this bridge. In such cases, refer to the documentation of the provider
to download the plugin. Once downloaded, this must be placed at <em>~/.terraform.d/plugins</em> and execution permissions must be given to it (<em>+x</em>).</p>
</div>
<div class="section" id="manage-ssh-keys">
<h2>1.2 Manage ssh keys<a class="headerlink" href="#manage-ssh-keys" title="Permalink to this headline">¶</a></h2>
<p>A ssh key pair is needed to establish connections to the VMs that will be created later. Therefore you must create (or import) this key on your provider beforehand
and place the private key at <em>~/.ssh/id_rsa</em>. Note errors may occur if your key doesn’t have the right permissions. Set these to the right value using the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> chmod <span class="m">600</span> path/to/key
</pre></div>
</div>
</div>
<div class="section" id="dependencies">
<h2>1.3 Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<p>This test-suite requires some packages to work properly and these must be installed by yourself.</p>
<div class="section" id="kubernetes-client">
<h3>Kubernetes client<a class="headerlink" href="#kubernetes-client" title="Permalink to this headline">¶</a></h3>
<p>In order to manage the Kubernetes cluster locally instead of using the master node, install <a class="reference external" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">kubectl</a> on your machine.</p>
</div>
<div class="section" id="python">
<h3>Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h3>
<p>Version python3 is required. In some Linux distributions, it has been seen not all the python required packages are included by default, like pyyaml.
In such cases, install the missing packages according to the error messages when running the test-suite.</p>
</div>
</div>
<div class="section" id="download-and-preparation">
<h2>1.4 Download and preparation<a class="headerlink" href="#download-and-preparation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="clone-repository">
<h3>Clone repository<a class="headerlink" href="#clone-repository" title="Permalink to this headline">¶</a></h3>
<p>Clone the repository as follows and cd into it:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git clone https://github.com/cern-it-efp/OCRE-Testsuite.git
<span class="gp">$</span> <span class="nb">cd</span> OCRE-Testsuite
</pre></div>
</div>
</div>
<div class="section" id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>While completing this task refer to <a class="reference external" href="https://www.terraform.io/docs/providers/">Terraform’s documentation</a> in order to complete it successfully as some parts are provider
specific and differ from one provider to another.
You will find on the root of the cloned repository a file named <em>configs_raw.yaml</em>. You must rename it <em>configs.yaml</em> and fill it to match your requirements. <strong>A filled example can be
found in */config_examples*</strong>. This file has different sections:</p>
<p><code class="docutils literal notranslate"><span class="pre">general</span></code></p>
<p>For specifying general variables:</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Explanation / Values</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>clusterNodes</td>
<td>Indicate the number of nodes the cluster must contain, including master node.</td>
</tr>
<tr class="row-odd"><td>providerName</td>
<td>Name of the provider for Terraform.</td>
</tr>
<tr class="row-even"><td>providerInstanceName</td>
<td>Compute instance name for Terraform. This is provider specific.</td>
</tr>
<tr class="row-odd"><td>pathToKey</td>
<td>Path to the location of your private key</td>
</tr>
<tr class="row-even"><td>dockerCE</td>
<td>Version of docker-ce to be installed. Leave empty for latest.</td>
</tr>
<tr class="row-odd"><td>dockerEngine</td>
<td>Version of docker-engine to be installed. Leave empty for latest.</td>
</tr>
<tr class="row-even"><td>kubernetes</td>
<td>Version of Kubernetes to be installed. Leave empty for latest.</td>
</tr>
</tbody>
</table>
<p>Note that it’s possible to chose between Docker Community Edition and Docker Engine (older Docker packages), however it is <strong>highly recommended</strong> to leave these variables empty to create a
cluster with the latest stack.</p>
<p><code class="docutils literal notranslate"><span class="pre">auth</span></code></p>
<p>For specifying the credentials to connect to the provider and deploy resources.</p>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Explanation / Values</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>useFile</td>
<td>Indicate if a credentials file is used instead of secret-key pair (Boolean). Required property.</td>
</tr>
<tr class="row-odd"><td>credentials</td>
<td>String block containing the required credentials. This is not yaml but string, therefore use ‘=’ and ‘ ” ‘. (Provider specific).</td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">instanceDefinition</span></code></p>
<p>In this section you should write all the key-pair values that would be written on the body of an instance declaration resource on Terraform, according to the provider you want to test.
Refer to the documentation of the provider to check which pairs you need to specify and in any case you can run the test-suite (next steps) and if there is any missing pair a message
will be shown on the terminal telling you which ones these are. This is how you must specify each pair:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">YOUR_PROVIDER</span><span class="s1">&#39;S_STRING_FOR_A_KEY&gt; = &quot;&lt;VALUE_GIVEN_FOR_THAT_KEY&gt;&quot;</span>
</pre></div>
</div>
<p>An example (Exoscale):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">display_name</span> <span class="o">=</span> <span class="s2">&quot;kubenode&quot;</span><span class="c1">#NAME</span>
<span class="n">template</span> <span class="o">=</span> <span class="s2">&quot;Linux CentOS 7.5 64-bit&quot;</span>
<span class="n">size</span> <span class="o">=</span> <span class="s2">&quot;Medium&quot;</span>
<span class="n">key_pair</span> <span class="o">=</span> <span class="s2">&quot;k_cl&quot;</span>
<span class="n">security_groups</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;kgroup&quot;</span><span class="p">]</span>
<span class="n">disk_size</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">zone</span> <span class="o">=</span> <span class="s2">&quot;ch-gva-2&quot;</span>
</pre></div>
</div>
<p>Pay attention on this section to the name for the instance. A random string will be added later to the name given to the instance in order to avoid DNS issues when running
the test-suite several times. For this, the block must contain the ‘#NAME’ placeholder. When specifying the name for the instance, follow this structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">YOUR_PROVIDER</span><span class="s1">&#39;S_STRING_FOR_NAME&gt; = &quot;&lt;NAME_FOR_YOUR_INSTANCES&gt;&quot;#NAME</span>
</pre></div>
</div>
<p>So lets image you provider’s string for the instance name is “display_name”, and you want to call your instances “kubenode” then you should write:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">display_name</span> <span class="o">=</span> <span class="s2">&quot;kubenode&quot;</span><span class="c1">#NAME</span>
</pre></div>
</div>
<p>Note the ‘#NAME’!</p>
<div class="line-block">
<div class="line">[<strong>NOTE</strong>: Even though this is a yaml file, ‘=’ is used on this section instead of ‘:’ as that is required on Terraform files and this will be taken as a whole block and placed directly on a .tf file]</div>
<div class="line">[<strong>NOTE2</strong>: providers that do not support resource creation with Terraform or k8saaS can’t be tested with this test-suite currently]</div>
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="tests-catalog">
<h3>Tests Catalog<a class="headerlink" href="#tests-catalog" title="Permalink to this headline">¶</a></h3>
<p>On the section <code class="docutils literal notranslate"><span class="pre">testsCatalog</span></code> of the <em>configs.yaml</em> file, you have to specify which tests you want to run. If you want to run certain test simply
set its <em>run</em> variable to the True Boolean value. On the other
hand if you don’t want it to be run set this value to False. Following find a description of each test:</p>
<p><strong>Deep Learning using GPU: trains a GAN making use of a Kubernetes cluster (GPU flavored) with Kubeflow and MPI.</strong></p>
<p>Note that for this test a cluster with GPU flavor is required.
For this test, besides the <em>run</em> variable, the following one can be set on the configs.yaml file:</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Explanation / Values</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>nodes</td>
<td>Number of nodes to be used for the deployment. If not set, the max number of nodes available will be used.</td>
</tr>
</tbody>
</table>
<p>Currently this test is still undergoing development and testing, hence it cant be deployed.</p>
<p>(Contributor/owner: Sofia Vallecorsa - <a class="reference external" href="mailto:sofia&#46;vallecorsa&#37;&#52;&#48;cern&#46;ch">sofia<span>&#46;</span>vallecorsa<span>&#64;</span>cern<span>&#46;</span>ch</a>)</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>S3 endpoint tests: An S3 test script that will check the following things:</strong></p>
<ul class="simple">
<li>S3 authentication (access key + secret key)</li>
<li>PUT</li>
<li>GET</li>
<li>GET with prefix matching</li>
<li>GET chunk</li>
<li>GET multiple chunks</li>
</ul>
<p>For this test, besides the <em>run</em> variable, the following ones must be set on the configs.yaml file:</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Explanation / Values</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>endpoint</td>
<td>Endpoint under which your S3 bucket is reachable. This URL must not include the bucket name but only the host.</td>
</tr>
<tr class="row-odd"><td>accessKey</td>
<td>Access key for S3 resource management.</td>
</tr>
<tr class="row-even"><td>secretKey</td>
<td>Secret key for S3 resource management.</td>
</tr>
</tbody>
</table>
<p>(Contributor/owner: Oliver Keeble - <a class="reference external" href="mailto:oliver&#46;keeble&#37;&#52;&#48;cern&#46;ch">oliver<span>&#46;</span>keeble<span>&#64;</span>cern<span>&#46;</span>ch</a>)</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Data repatriation test: Take data from a VM running on a cloud provider to Zenodo.</strong></p>
<p>In the chase of making the scientific community embrace a vouchers usage of cloud computing, there is always a drawback: once my
cloud credits are over, what can I do with the data I have on the cloud? Zenodo is a tool developed by CERN useful in this case as it
keeps data for the long term and it is free. What this test does is to verify that data can be taken from the private cloud being tested onto Zenodo.</p>
<p>(Contributor/owner: Ignacio Peluaga - <a class="reference external" href="mailto:ignacio&#46;peluaga&#46;lozada&#37;&#52;&#48;cern&#46;ch">ignacio<span>&#46;</span>peluaga<span>&#46;</span>lozada<span>&#64;</span>cern<span>&#46;</span>ch</a>)</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>CPU Benchmarking: Containerised benchmarking tools.</strong></p>
<p>The following benchmarks are run on the provider side using a containerised approach:</p>
<ul class="simple">
<li>DIRAC Benchmark</li>
<li>ATLAS Kit Validation</li>
<li>Whetstone: from the UnixBench benchmark suite.</li>
<li>Hyper-benchmark: A pre-defined sequence of measurements and fast benchmarks.</li>
</ul>
<p>(Contributor/owner: Domenico Giordano - <a class="reference external" href="mailto:domenico&#46;giordano&#37;&#52;&#48;cern&#46;ch">domenico<span>&#46;</span>giordano<span>&#64;</span>cern<span>&#46;</span>ch</a>)</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>perfSONAR: Networking performance measurements.</strong></p>
<p>A perfSONAR testpoint is created using a containerised approach on the provider side. The following tests are launched from there to the endpoint provided by the user:</p>
<ul class="simple">
<li>throughput: A test to measure the observed speed of a data transfer and associated statistics between two endpoints.</li>
<li>rtt: Measure the round trip time and related statistics between hosts.</li>
<li>trace: Trace the path between IP hosts.</li>
<li>latencybg: Continuously measure one-way latency and associated statistics between hosts and report back results periodically.</li>
</ul>
<p>The endpoint for these tests must be specified at configs’ <em>endpoint</em> variable. Use endpoints from:</p>
<ul class="simple">
<li><a class="reference external" href="https://fasterdata.es.net/performance-testing/perfsonar/esnet-perfsonar-services/esnet-iperf-hosts/">Here</a></li>
<li><a class="reference external" href="http://perfsonar-otc.hnsc.otc-service.com/toolkit/">Here</a></li>
<li><a class="reference external" href="http://stats.es.net/ServicesDirectory/">Here</a></li>
</ul>
<p>(Contributor/owner: Marian Babik - <a class="reference external" href="mailto:marian&#46;babik&#37;&#52;&#48;cern&#46;ch">marian<span>&#46;</span>babik<span>&#64;</span>cern<span>&#46;</span>ch</a>)</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>HPC test: ESRF’s FDMNES: Simulation of x-ray spectroscopies.</strong></p>
<p>Parallel calculations on Linux using OpenMPI. Rather heavy on CPU and memory, light on IO.
This test is still under development and will be available on next releases.</p>
<p>(Contributor/owner: Rainer Wilcke - <a class="reference external" href="mailto:wilcke&#37;&#52;&#48;esrf&#46;fr">wilcke<span>&#64;</span>esrf<span>&#46;</span>fr</a>)</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>[<strong>NOTE</strong>: If no test’s <em>run</em> is set to True, this tool will simply create a raw Kubernetes cluster]</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="run-the-test-suite">
<h2>1.5 Run the test-suite<a class="headerlink" href="#run-the-test-suite" title="Permalink to this headline">¶</a></h2>
<p>Once all the previous steps are completed, the test-suite is ready to be run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ./test_suite.py &lt;options&gt;
</pre></div>
</div>
<p>Terraform will first show the user what it is going to do, what to create. If agreed, type “yes” and press enter.</p>
<div class="section" id="options">
<h3>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h3>
<p>The following table describes all the accepted options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Explanation / Values</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>–only-test</td>
<td>Run without creating the infrastructure (VMs and cluster), only deploy tests. Not valid for the first run.</td>
</tr>
<tr class="row-odd"><td>–auto-retry</td>
<td>Automatically retry in case of errors on the Terraform phase. Note that in the case errors occur, the user will have to stop the run using Ctrl+z.</td>
</tr>
<tr class="row-even"><td>–via-backend</td>
<td>Runs the Test-Suite using CERN’s backend service instead of the cloned local version. This option must be used for verification (2nd or later runs).</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="existingClusters.html" class="btn btn-neutral float-right" title="2. Using existing clusters" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="OCRE Test-Suite for cloud validation - CERN" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, CERN IT-DI-EFP

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>