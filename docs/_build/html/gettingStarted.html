

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1. Getting started &mdash; Cloud Test Suite - CERN IT  documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="AWS" href="clouds/aws.html" />
    <link rel="prev" title="EOSC Cloud Validation Test Suite" href="index.html" />
    <link href="_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Cloud Test Suite Documentation</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">1.1 Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#terraform">Terraform</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ansible">Ansible</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kubernetes-client">Kubernetes client</a></li>
<li class="toctree-l3"><a class="reference internal" href="#python">Python</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ssh-key">1.2 SSH key</a></li>
<li class="toctree-l2"><a class="reference internal" href="#security-groups">1.3 Security groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="#networking-and-ips">1.4 Networking and IPs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#clone-and-prepare">1.5 Clone and prepare</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cloning-repository">Cloning repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="clouds/aws.html">AWS</a></li>
<li class="toctree-l4"><a class="reference internal" href="clouds/azurerm.html">Azure</a></li>
<li class="toctree-l4"><a class="reference internal" href="clouds/cloudstack.html">CloudStack</a></li>
<li class="toctree-l4"><a class="reference internal" href="clouds/exoscale.html">Exoscale</a></li>
<li class="toctree-l4"><a class="reference internal" href="clouds/google.html">GCP</a></li>
<li class="toctree-l4"><a class="reference internal" href="clouds/oci.html">Oracle Cloud Infrastructure</a></li>
<li class="toctree-l4"><a class="reference internal" href="clouds/openstack.html">OpenStack</a></li>
<li class="toctree-l4"><a class="reference internal" href="clouds/opentelekomcloud.html">T-Systems’ Open Telekom Cloud</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-docker">1.6 Using Docker</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="testsCatalog.html">2. Tests Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="run.html">3. Run</a></li>
<li class="toctree-l1"><a class="reference internal" href="existingClusters.html">4. Using existing clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="noTerraform.html">5. No Terraform runs</a></li>
<li class="toctree-l1"><a class="reference internal" href="results.html">6. Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="costs.html">7. Cost of run calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="projects.html">Projects</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Cloud Test Suite - CERN IT</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>1. Getting started</li>
    
    

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="getting-started">
<h1>1. Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<p>Please follow the steps below in order to deploy tests in a cloud provider.</p>
<p>Refer to section “Using Docker” to use the Docker image we provide to avoid dealing with required packages and dependencies.</p>
<div class="section" id="dependencies">
<h2>1.1 Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<p>This test-suite requires some packages to work properly and these must be installed by yourself directly. Please see below.</p>
<div class="section" id="terraform">
<h3>Terraform<a class="headerlink" href="#terraform" title="Permalink to this headline">¶</a></h3>
<p>Terraform is the tool that creates the VMs that will later become a Kubernetes cluster. The test-suite makes use of it so download and
install <a href="https://learn.hashicorp.com/terraform/getting-started/install.html" target="_blank">Terraform</a> on your machine.
In some cases, providers are not fully supported by Terraform, however they might provide plugins to bridge this gap. In such cases, please refer to the documentation of the provider to download the plugin.
Once downloaded, this must be placed at <em>~/.terraform.d/plugins</em> and execution permissions must be given to it (<em>+x</em>).</p>
</div>
<div class="section" id="ansible">
<h3>Ansible<a class="headerlink" href="#ansible" title="Permalink to this headline">¶</a></h3>
<p>Ansible is used to configure the VMs and install packages on them in order to bootstrap the cluster. Follow the steps <a href="https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html#installing-ansible-with-pip" target="_blank">here</a> to install it.</p>
</div>
<div class="section" id="kubernetes-client">
<h3>Kubernetes client<a class="headerlink" href="#kubernetes-client" title="Permalink to this headline">¶</a></h3>
<p>In order to manage the Kubernetes cluster locally instead of using the master node, install <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" target="_blank">kubectl</a> on your machine.</p>
</div>
<div class="section" id="python">
<h3>Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h3>
<p>Python version 3 is required.
The following python packages are required:</p>
<ul class="simple">
<li>pyyaml</li>
<li>jsonschema</li>
<li>kubernetes</li>
<li>requests</li>
</ul>
<p>Please install them with pip3.</p>
</div>
</div>
<div class="section" id="ssh-key">
<h2>1.2 SSH key<a class="headerlink" href="#ssh-key" title="Permalink to this headline">¶</a></h2>
<p>A ssh key pair is needed to establish connections to the VMs to be created later. Therefore, you must create (or import) this key on your provider, when needed, beforehand.
Note errors may occur if your key doesn’t have the right permissions. Set these to the right value using the following command:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> chmod <span class="m">600</span> path/to/key
</pre></div>
</div>
</div>
<div class="section" id="security-groups">
<h2>1.3 Security groups<a class="headerlink" href="#security-groups" title="Permalink to this headline">¶</a></h2>
<p>The following ports have to be opened:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Port</th>
<th class="head">Protocol</th>
<th class="head">Functionality</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#160;</td>
<td>ICMP</td>
<td>Connectivity test</td>
</tr>
<tr class="row-odd"><td>22</td>
<td>TCP</td>
<td>SSH</td>
</tr>
<tr class="row-even"><td>6443</td>
<td>TCP</td>
<td>Kubernetes API</td>
</tr>
<tr class="row-odd"><td>10250</td>
<td>TCP</td>
<td>API which allows node access</td>
</tr>
<tr class="row-even"><td>8472</td>
<td>UDP</td>
<td>Flannel overlay network, k8s pods communication</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="networking-and-ips">
<h2>1.4 Networking and IPs<a class="headerlink" href="#networking-and-ips" title="Permalink to this headline">¶</a></h2>
<p>Some providers do not allocate public IPs to the VMs but use NAT. Hence the VM can be reached from outside but that IP is not actually residing on the VM, which causes
conflicts when creating the Kubernetes cluster. If one wants to run the Test-Suite on a provider of this case, then the suite must be launched from within the
network the nodes will be connected to, this is a private network. In other words, <strong>a VM will have to be created first manually</strong> and the Test Suite will have to be
triggered from there. This way all the communications can happen without NAT.</p>
</div>
<div class="section" id="clone-and-prepare">
<h2>1.5 Clone and prepare<a class="headerlink" href="#clone-and-prepare" title="Permalink to this headline">¶</a></h2>
<div class="section" id="cloning-repository">
<h3>Cloning repository<a class="headerlink" href="#cloning-repository" title="Permalink to this headline">¶</a></h3>
<p>Please clone the repository as follows and cd into it. This step is not needed when using the provided Docker image, the repository is already cloned there.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> git clone https://github.com/cern-it-efp/EOSC-Testsuite.git
<span class="gp">$</span> <span class="nb">cd</span> EOSC-Testsuite
</pre></div>
</div>
</div>
<div class="section" id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>Two YAML files have to be filled to configure the run. Examples of these two files can be found inside the examples folder of the repository.</p>
<p><code class="docutils literal"><span class="pre">testsCatalog.yaml</span></code></p>
<p>This file gathers details related to the tests that should be deployed.
Refer to the section “Test Catalog” to learn how to fill this file.</p>
<p><code class="docutils literal"><span class="pre">configs.yaml</span></code></p>
<p>This file gathers general details required to provision the infrastructure.
The file also contains a section named <em>costCalculation</em>. Refer to the section “Cost of run calculation” to understand how to fill that part.
The suite will create itself the Terraform files on the fly according to the configuration provided.</p>
<p><strong>General variables:</strong></p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Explanation / Values</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>providerName</td>
<td>Terraform name of the provider. (required)</td>
</tr>
<tr class="row-odd"><td>pathToKey</td>
<td>Path to the location of your private key, to be used for ssh connections. (required)</td>
</tr>
<tr class="row-even"><td>flavor</td>
<td>Flavor to be used for the main cluster. (required)</td>
</tr>
<tr class="row-odd"><td>openUser</td>
<td>User to be used for ssh connections.</td>
</tr>
</tbody>
</table>
<p><strong>Provider/cloud specific variables:</strong></p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="clouds/aws.html">AWS</a></li>
<li class="toctree-l1"><a class="reference internal" href="clouds/azurerm.html">Azure</a></li>
<li class="toctree-l1"><a class="reference internal" href="clouds/cloudstack.html">CloudStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="clouds/exoscale.html">Exoscale</a></li>
<li class="toctree-l1"><a class="reference internal" href="clouds/google.html">GCP</a></li>
<li class="toctree-l1"><a class="reference internal" href="clouds/oci.html">Oracle Cloud Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="clouds/openstack.html">OpenStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="clouds/opentelekomcloud.html">T-Systems’ Open Telekom Cloud</a></li>
</ul>
</div>
<p>To run the suite on a provider/cloud that is not listed above, refer to the section <a class="reference internal" href="noTerraform.html#no-terraform-runs"><span class="std std-ref">No Terraform runs</span></a>.</p>
</div>
</div>
<div class="section" id="using-docker">
<h2>1.6 Using Docker<a class="headerlink" href="#using-docker" title="Permalink to this headline">¶</a></h2>
<p>A Docker image has been built and pushed to Docker hub. This image allows you to skip section “Dependencies” and jump to “SSH key”.</p>
<p>Run the container (pulls the image first):</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> docker run --net<span class="o">=</span>host -it cernefp/tslauncher
</pre></div>
</div>
<p>Note the option ‘–net=host’. Without it, the container wouldn’t be able to connect to the nodes, as it
would not be in the same network as them and it is likely the nodes will not have public IPs (no NAT).
With that option, the container will use the network used by its host.</p>
<p>You will get a session on the container, directly inside the cloned repository.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, CERN IT-DI-EFP
      <span class="lastupdated">
        Last updated on True.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>